<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plaid Solutions Architect AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;600&family=Unna:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #D8FEF3 0%, #CCF8FF 50%, #E6E6FF 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #10D1B7 0%, #0DADF2 50%, #8B8BF9 100%);
            padding: 40px 50px;
            border-radius: 16px;
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #46DA10 0%, #FBDE51 33%, #EE99FF 66%, #51D2FB 100%);
        }
        
        h1 {
            font-size: 36px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.95;
            line-height: 1.5;
        }
        
        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }
        
        /* Input Panel */
        .input-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(1, 46, 55, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .panel-header {
            font-size: 24px;
            font-weight: 600;
            color: #05565C;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 3px solid #D8FEF3;
        }
        
        .example-prompts {
            margin-bottom: 24px;
        }
        
        .example-label {
            font-size: 14px;
            font-weight: 600;
            color: #088181;
            margin-bottom: 12px;
        }
        
        .example-chip {
            display: inline-block;
            background: linear-gradient(135deg, #D8FEF3 0%, #E6E6FF 100%);
            border: 2px solid #10D1B7;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            color: #05565C;
            cursor: pointer;
            margin: 4px;
            transition: all 0.3s ease;
        }
        
        .example-chip:hover {
            background: linear-gradient(135deg, #10D1B7 0%, #0DADF2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 209, 183, 0.3);
        }
        
        .input-area {
            margin-bottom: 20px;
        }
        
        .input-label {
            font-size: 15px;
            font-weight: 600;
            color: #05565C;
            margin-bottom: 8px;
            display: block;
        }
        
        .text-input {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid #D8FEF3;
            border-radius: 12px;
            font-family: 'Figtree', sans-serif;
            font-size: 15px;
            color: #012E37;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .text-input:focus {
            outline: none;
            border-color: #10D1B7;
            box-shadow: 0 0 0 3px rgba(16, 209, 183, 0.1);
        }
        
        .select-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #D8FEF3;
            border-radius: 12px;
            font-family: 'Figtree', sans-serif;
            font-size: 15px;
            color: #012E37;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .select-input:focus {
            outline: none;
            border-color: #10D1B7;
        }
        
        .generate-button {
            background: linear-gradient(135deg, #10D1B7 0%, #0DADF2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(16, 209, 183, 0.3);
        }
        
        .generate-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #42F0CD 0%, #51D2FB 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(16, 209, 183, 0.4);
        }
        
        .generate-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Output Panel */
        .output-panel {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(1, 46, 55, 0.1);
            min-height: 600px;
        }
        
        .placeholder {
            text-align: center;
            padding: 100px 40px;
            color: #088181;
        }
        
        .placeholder-icon {
            font-size: 80px;
            margin-bottom: 24px;
        }
        
        .placeholder h2 {
            font-size: 28px;
            color: #05565C;
            margin-bottom: 12px;
        }
        
        .placeholder p {
            font-size: 16px;
            line-height: 1.6;
        }
        
        /* Loading State */
        .loading-state {
            display: none;
            padding: 40px;
        }
        
        .loading-state.active {
            display: block;
        }
        
        .loading-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .loading-spinner {
            font-size: 48px;
            display: inline-block;
            margin-bottom: 16px;
            position: relative;
        }
        
        .architect-scene {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            font-size: 48px;
        }
        
        .architect {
            animation: architect-work 2s ease-in-out infinite;
            display: inline-block;
        }
        
        .blueprint {
            animation: blueprint-appear 2s ease-in-out infinite;
            display: inline-block;
        }
        
        .house-building {
            animation: house-build 2s ease-in-out infinite;
            display: inline-block;
        }
        
        @keyframes architect-work {
            0%, 100% { transform: rotate(0deg) translateY(0); }
            25% { transform: rotate(-5deg) translateY(-3px); }
            50% { transform: rotate(5deg) translateY(0); }
            75% { transform: rotate(-5deg) translateY(-3px); }
        }
        
        @keyframes blueprint-appear {
            0%, 100% { opacity: 0.6; transform: scale(0.9); }
            50% { opacity: 1; transform: scale(1.05); }
        }
        
        @keyframes house-build {
            0% { opacity: 0.3; transform: scale(0.7); }
            50% { opacity: 0.6; transform: scale(0.85); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .loading-step {
            background: linear-gradient(135deg, #F9FFFE 0%, #FAFCFF 100%);
            border-left: 4px solid #D8FEF3;
            padding: 16px 20px;
            margin-bottom: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.4s ease;
        }
        
        .loading-step.active {
            border-left-color: #10D1B7;
            background: linear-gradient(135deg, #D8FEF3 0%, #E6E6FF 100%);
        }
        
        .loading-step.completed {
            border-left-color: #46DA10;
            background: linear-gradient(135deg, #E8FED7 0%, #D8FEF3 100%);
        }
        
        .step-icon {
            font-size: 24px;
        }
        
        .step-text {
            flex: 1;
            font-size: 15px;
            color: #05565C;
            font-weight: 500;
        }
        
        /* Result Tabs */
        .result-container {
            display: none;
        }
        
        .result-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            border-bottom: 2px solid #D8FEF3;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #088181;
            font-family: 'Figtree', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab:hover {
            color: #10D1B7;
        }
        
        .tab.active {
            color: #10D1B7;
            border-bottom-color: #10D1B7;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* Product Cards */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }
        
        .product-card {
            background: linear-gradient(135deg, #F9FFFE 0%, #FAFCFF 100%);
            border: 2px solid #D8FEF3;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .product-card:hover {
            border-color: #10D1B7;
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(16, 209, 183, 0.15);
        }
        
        .product-card.selected {
            background: linear-gradient(135deg, #E8FED7 0%, #D8FEF3 100%);
            border-color: #46DA10;
            border-width: 3px;
        }
        
        .product-card.selected:hover {
            border-color: #EE5555;
            background: linear-gradient(135deg, #FFE6E6 0%, #FFF6D8 100%);
        }
        
        .product-card.selected:hover .product-badge {
            background: #EE5555;
        }
        
        .product-card.available {
            background: linear-gradient(135deg, #FFE6E6 0%, #FFF6D8 100%);
            border-color: #EBCB00;
            opacity: 0.7;
        }
        
        .product-card.available:hover {
            opacity: 1;
            border-color: #10D1B7;
        }
        
        .product-card.available:hover .product-badge {
            background: #10D1B7;
            transform: scale(1.1);
        }
        
        .product-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .product-card.selected .product-badge {
            background: #46DA10;
            color: white;
        }
        
        .product-card.available .product-badge {
            background: #EBCB00;
            color: white;
        }
        
        .product-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        
        .product-name {
            font-size: 18px;
            font-weight: 600;
            color: #05565C;
            margin-bottom: 8px;
        }
        
        .product-desc {
            font-size: 13px;
            color: #088181;
            line-height: 1.4;
        }
        
        .regenerate-button {
            background: linear-gradient(135deg, #8B8BF9 0%, #EE99FF 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(139, 139, 249, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 20px 0;
        }
        
        .regenerate-button:hover {
            background: linear-gradient(135deg, #A5A5FF 0%, #FFA8FF 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(139, 139, 249, 0.4);
        }
        
        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 24px 0 16px;
        }
        
        .add-products-section {
            margin-top: 32px;
            padding-top: 32px;
            border-top: 2px solid #D8FEF3;
        }
        
        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, #D8FEF3 0%, #CCF8FF 100%);
            border-left: 6px solid #10D1B7;
            padding: 20px 24px;
            margin: 24px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(8, 129, 129, 0.1);
        }
        
        .info-box h3 {
            color: #05565C;
            font-size: 18px;
            margin-bottom: 12px;
        }
        
        .info-box p, .info-box ul {
            color: #012E37;
            line-height: 1.7;
        }
        
        .info-box ul {
            margin: 12px 0 0 0;
            padding-left: 0;
            list-style: none;
        }
        
        .info-box ul li {
            margin: 12px 0;
            padding-left: 24px;
            position: relative;
        }
        
        .info-box ul li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: #46DA10;
            font-weight: bold;
            font-size: 16px;
        }
        
        .info-box ul li strong {
            color: #05565C;
            font-weight: 600;
        }
        
        /* Code Block */
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .language-tabs {
            display: flex;
            gap: 8px;
        }
        
        .lang-tab {
            padding: 8px 16px;
            background: #F9FFFE;
            border: 2px solid #D8FEF3;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            color: #088181;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .lang-tab:hover {
            border-color: #10D1B7;
        }
        
        .lang-tab.active {
            background: linear-gradient(135deg, #10D1B7 0%, #0DADF2 100%);
            color: white;
            border-color: #10D1B7;
        }
        
        .code-block {
            background: #012E37;
            color: #D8FEF3;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            margin: 16px 0;
            border: 2px solid #05565C;
            position: relative;
        }
        
        .code-block pre {
            margin: 0;
        }
        
        .copy-button {
            background: linear-gradient(135deg, #10D1B7 0%, #0DADF2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(16, 209, 183, 0.2);
        }
        
        .copy-button:hover {
            background: linear-gradient(135deg, #42F0CD 0%, #51D2FB 100%);
            transform: translateY(-1px);
        }
        
        .copy-button.copied {
            background: linear-gradient(135deg, #46DA10 0%, #8CF25A 100%);
        }
        
        /* Diagram */
        .diagram-container {
            background: linear-gradient(135deg, #F9FFFE 0%, #FAFCFF 100%);
            padding: 30px;
            border-radius: 12px;
            overflow-x: auto;
            border: 2px solid #D8FEF3;
            box-shadow: 0 4px 16px rgba(8, 129, 129, 0.08);
            margin: 24px 0;
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
        }
        
        /* Scope Calculator */
        .scope-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }
        
        .scope-card {
            background: white;
            border: 2px solid #D8FEF3;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(8, 129, 129, 0.06);
        }
        
        .scope-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }
        
        .scope-label {
            font-size: 14px;
            color: #088181;
            margin-bottom: 8px;
        }
        
        .scope-value {
            font-family: 'Unna', serif;
            font-size: 32px;
            font-weight: 700;
            color: #10D1B7;
            margin-bottom: 8px;
        }
        
        .scope-detail {
            font-size: 13px;
            color: #012E37;
            line-height: 1.5;
        }
        
        .complexity-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 8px;
        }
        
        .complexity-low {
            background: linear-gradient(135deg, #E8FED7 0%, #D8FEF3 100%);
            color: #0B5C05;
            border: 2px solid #46DA10;
        }
        
        .complexity-medium {
            background: linear-gradient(135deg, #FFF6D8 0%, #F9DBFF 100%);
            color: #615E00;
            border: 2px solid #EBCB00;
        }
        
        .complexity-high {
            background: linear-gradient(135deg, #FFE6E6 0%, #FFF6D8 100%);
            color: #5C0000;
            border: 2px solid #EE5555;
        }
        
        .timeline-phase {
            background: linear-gradient(135deg, #F9FFFE 0%, #FAFCFF 100%);
            border-left: 4px solid #10D1B7;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
        }
        
        .phase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .phase-name {
            font-size: 16px;
            font-weight: 600;
            color: #05565C;
        }
        
        .phase-duration {
            font-size: 14px;
            font-weight: 600;
            color: #10D1B7;
        }
        
        .phase-tasks {
            font-size: 13px;
            color: #012E37;
            line-height: 1.6;
        }
        
        /* Export Section */
        .export-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        .export-button {
            padding: 12px 24px;
            border-radius: 8px;
            font-family: 'Figtree', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8B8BF9 0%, #EE99FF 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(139, 139, 249, 0.4);
        }
        
        .btn-secondary {
            background: white;
            color: #05565C;
            border: 2px solid #D8FEF3;
        }
        
        .btn-secondary:hover {
            border-color: #10D1B7;
            background: #F9FFFE;
        }
        
        /* Notification Toast */
        .notification-toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #10D1B7 0%, #0DADF2 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(16, 209, 183, 0.4);
            font-size: 15px;
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .notification-toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .input-panel {
                position: static;
            }
            
            .notification-toast {
                bottom: 20px;
                right: 20px;
                left: 20px;
                text-align: center;
            }
        }
        
        /* Section Headers */
        .section-header {
            font-size: 24px;
            font-weight: 600;
            color: #05565C;
            margin: 32px 0 20px;
            padding-left: 16px;
            border-left: 4px solid #10D1B7;
        }
        
        /* Doc Links */
        .doc-links {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .doc-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #10D1B7 0%, #0DADF2 100%);
            color: white;
            padding: 10px 18px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(16, 209, 183, 0.2);
        }
        
        .doc-link:hover {
            background: linear-gradient(135deg, #42F0CD 0%, #51D2FB 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 209, 183, 0.3);
        }
    </style>
    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <span>üèóÔ∏è</span>
                <span>Plaid Solutions Architect AI</span>
            </h1>
            <p class="subtitle">
                Describe any customer use case and get instant product recommendations, working code examples, 
                architecture diagrams, and integration scope estimates. Powered by AI + AskBill.
            </p>
        </div>
        
        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Input Panel -->
            <div class="input-panel">
                <div class="panel-header">
                    üí¨ Describe Your Use Case
                </div>
                
                <!-- Example Prompts -->
                <div class="example-prompts">
                    <div class="example-label">Try these examples:</div>
                    <span class="example-chip" onclick="fillExample('payroll-savings')">üí∞ Payroll-linked savings</span>
                    <span class="example-chip" onclick="fillExample('lending')">üìä Lending platform</span>
                    <span class="example-chip" onclick="fillExample('payment')">üí≥ ACH payment app</span>
                    <span class="example-chip" onclick="fillExample('pfm')">üì± Budgeting app</span>
                    <span class="example-chip" onclick="fillExample('crypto')">‚Çø Crypto on/off ramp</span>
                </div>
                
                <!-- Use Case Input -->
                <div class="input-area">
                    <label class="input-label">What are you building?</label>
                    <textarea 
                        id="useCaseInput" 
                        class="text-input" 
                        placeholder="Example: I need to build a lending platform that verifies income, checks bank balance in real-time, assesses ACH return risk, and initiates loan disbursements..."
                    ></textarea>
                </div>
                
                <!-- Customer Context -->
                <div class="input-area">
                    <label class="input-label">Customer Industry (Optional)</label>
                    <select id="industrySelect" class="select-input">
                        <option value="">Select industry...</option>
                        <option value="fintech">Fintech</option>
                        <option value="lending">Lending</option>
                        <option value="crypto">Crypto</option>
                        <option value="banking">Banking</option>
                        <option value="payments">Payments</option>
                        <option value="wealth">Wealth Management</option>
                        <option value="insurance">Insurance</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <!-- Preferred Language -->
                <div class="input-area">
                    <label class="input-label">Preferred Language</label>
                    <select id="languageSelect" class="select-input">
                        <option value="node">Node.js</option>
                        <option value="python">Python</option>
                        <option value="both">Both</option>
                    </select>
                </div>
                
                <!-- Generate Button -->
                <button class="generate-button" onclick="generateSolution()">
                    ‚ú® Generate Solution Architecture
                </button>
            </div>
            
            <!-- Output Panel -->
            <div class="output-panel">
                <!-- Placeholder -->
                <div id="placeholder" class="placeholder">
                    <div class="placeholder-icon">üèóÔ∏è</div>
                    <h2>Ready to Architect Your Solution</h2>
                    <p>Describe your use case on the left, and I'll analyze it to provide:</p>
                    <br>
                    <p style="text-align: left; max-width: 500px; margin: 0 auto;">
                        ‚úÖ <strong>Product Recommendations</strong> - Which Plaid products to use<br>
                        ‚úÖ <strong>Architecture Diagram</strong> - Complete sequence flows<br>
                        ‚úÖ <strong>Code Examples</strong> - Ready-to-use implementation<br>
                        ‚úÖ <strong>Scope Estimate</strong> - Timeline, complexity & resources<br>
                        ‚úÖ <strong>Exportable Guide</strong> - Share with your customer
                    </p>
                </div>
                
                <!-- Loading State -->
                <div id="loadingState" class="loading-state">
                    <div class="loading-header">
                        <div class="loading-spinner">
                            <div class="architect-scene">
                                <span class="architect">üë∑</span>
                                <span class="blueprint">üìê</span>
                                <span class="house-building">üèóÔ∏è</span>
                            </div>
                        </div>
                        <h2 style="color: #05565C; margin-bottom: 8px;">Architecting Your Solution...</h2>
                        <p style="color: #088181;">This will take just a moment</p>
                    </div>
                    
                    <div id="step1" class="loading-step">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Analyzing use case requirements...</span>
                    </div>
                    <div id="step2" class="loading-step">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Querying Plaid documentation via AskBill...</span>
                    </div>
                    <div id="step3" class="loading-step">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Identifying optimal product combinations...</span>
                    </div>
                    <div id="step4" class="loading-step">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Generating architecture diagrams...</span>
                    </div>
                    <div id="step5" class="loading-step">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Writing code examples...</span>
                    </div>
                    <div id="step6" class="loading-step">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Calculating integration scope...</span>
                    </div>
                </div>
                
                <!-- Results -->
                <div id="resultContainer" class="result-container">
                    <!-- Tabs -->
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('overview')">üìã Overview</button>
                        <button class="tab" onclick="switchTab('architecture')">üèóÔ∏è Architecture</button>
                        <button class="tab" onclick="switchTab('code')">üíª Code</button>
                        <button class="tab" onclick="switchTab('demo')">üöÄ Live Demo</button>
                        <button class="tab" onclick="switchTab('scope')">‚è±Ô∏è Scope Calculator</button>
                        <button class="tab" onclick="switchTab('export')">üì§ Export</button>
                    </div>
                    
                    <!-- Overview Tab -->
                    <div id="overviewTab" class="tab-content active">
                        <h2 class="section-header">Recommended Solution</h2>
                        <div id="overviewContent"></div>
                    </div>
                    
                    <!-- Architecture Tab -->
                    <div id="architectureTab" class="tab-content">
                        <h2 class="section-header">Solution Architecture</h2>
                        <div id="architectureContent"></div>
                    </div>
                    
                    <!-- Code Tab -->
                    <div id="codeTab" class="tab-content">
                        <h2 class="section-header">Implementation Code</h2>
                        <div id="codeContent"></div>
                    </div>
                    
                    <!-- Demo Tab -->
                    <div id="demoTab" class="tab-content">
                        <h2 class="section-header">Live Integration Demo</h2>
                        <div id="demoContent"></div>
                    </div>
                    
                    <!-- Scope Tab -->
                    <div id="scopeTab" class="tab-content">
                        <h2 class="section-header">Integration Scope Calculator</h2>
                        <div id="scopeContent"></div>
                    </div>
                    
                    <!-- Export Tab -->
                    <div id="exportTab" class="tab-content">
                        <h2 class="section-header">Export Solution Guide</h2>
                        <div id="exportContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35
            }
        });
        
        // Example use cases
        const examples = {
            'payroll-savings': 'I want to build an app that automatically saves 10% of each paycheck. When a user gets paid, detect the deposit, verify it\'s from their employer, calculate 10%, and transfer that amount to their savings account.',
            'lending': 'I need a lending platform that verifies income and employment, checks real-time account balances, assesses ACH return risk before disbursement, and initiates loan payments.',
            'payment': 'Building a B2B payment platform that needs to verify bank accounts instantly (no micro-deposits), check balances before initiating payments, and minimize ACH returns.',
            'pfm': 'Creating a personal finance app that aggregates accounts from multiple banks, automatically categorizes transactions, sends real-time spending alerts, and provides budgeting insights.',
            'crypto': 'Building a crypto on/off ramp that needs instant bank account verification, real-time balance checks, identity verification for KYC/AML, and fast ACH transfers for buying crypto.'
        };
        
        // Fill example
        function fillExample(exampleKey) {
            document.getElementById('useCaseInput').value = examples[exampleKey];
        }
        
        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
        }
        
        // Generate solution
        async function generateSolution() {
            const useCase = document.getElementById('useCaseInput').value.trim();
            
            if (!useCase) {
                alert('Please describe your use case first!');
                return;
            }
            
            // Hide placeholder
            document.getElementById('placeholder').style.display = 'none';
            
            // Show loading
            const loadingState = document.getElementById('loadingState');
            loadingState.classList.add('active');
            
            // Simulate AI processing steps
            await simulateSteps();
            
            // Analyze use case and generate solution
            const solution = analyzeSolution(useCase);
            
            // Hide loading
            loadingState.classList.remove('active');
            
            // Show results
            displayResults(solution);
        }
        
        // Simulate processing steps
        async function simulateSteps() {
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5', 'step6'];
            
            for (let i = 0; i < steps.length; i++) {
                const step = document.getElementById(steps[i]);
                step.classList.add('active');
                
                await new Promise(resolve => setTimeout(resolve, 600));
                
                step.classList.remove('active');
                step.classList.add('completed');
                step.querySelector('.step-icon').textContent = '‚úÖ';
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }
        }
        
        // Analyze solution based on keywords
        function analyzeSolution(useCase) {
            const useCaseLower = useCase.toLowerCase();
            const products = [];
            let complexity = 'medium';
            let timeline = { weeks: 6 };
            
            // Detect products based on keywords
            // Note: Link is NOT a product - it's the UI component used to connect
            
            if (useCaseLower.includes('income') || useCaseLower.includes('paycheck') || useCaseLower.includes('salary') || useCaseLower.includes('employment')) {
                products.push('income');
            }
            
            if (useCaseLower.includes('transaction') || useCaseLower.includes('spending') || useCaseLower.includes('budget') || useCaseLower.includes('categoriz')) {
                products.push('transactions');
            }
            
            if (useCaseLower.includes('balance') || useCaseLower.includes('funds') || useCaseLower.includes('nsf')) {
                products.push('balance');
            }
            
            if (useCaseLower.includes('payment') || useCaseLower.includes('transfer') || useCaseLower.includes('ach') || useCaseLower.includes('disburse')) {
                products.push('transfer');
            }
            
            if (useCaseLower.includes('risk') || useCaseLower.includes('fraud') || useCaseLower.includes('return')) {
                products.push('signal');
            }
            
            if (useCaseLower.includes('verify') || useCaseLower.includes('instant') || useCaseLower.includes('routing') || useCaseLower.includes('account number')) {
                products.push('auth');
            }
            
            if (useCaseLower.includes('identity') || useCaseLower.includes('kyc') || useCaseLower.includes('aml') || useCaseLower.includes('document')) {
                products.push('identity_verification');
            }
            
            if (useCaseLower.includes('asset') || useCaseLower.includes('net worth') || useCaseLower.includes('wealth')) {
                products.push('assets');
            }
            
            if (useCaseLower.includes('lend') || useCaseLower.includes('loan') || useCaseLower.includes('credit') || useCaseLower.includes('underwriting')) {
                products.push('check');
                if (!products.includes('income')) products.push('income');
            }
            
            // Default to common products if nothing detected
            if (products.length === 0) {
                products.push('transactions', 'auth');
            }
            
            // Calculate complexity
            if (products.length <= 2) {
                complexity = 'low';
                timeline.weeks = 3;
            } else if (products.length >= 5) {
                complexity = 'high';
                timeline.weeks = 10;
            }
            
            return {
                useCase,
                products: [...new Set(products)], // Remove duplicates
                complexity,
                timeline
            };
        }
        
        // Store current solution globally for regeneration
        let currentSolution = null;
        
        // Display results
        function displayResults(solution) {
            currentSolution = solution; // Store for later regeneration
            const container = document.getElementById('resultContainer');
            container.classList.add('active');
            
            // Generate all content
            generateOverview(solution);
            generateArchitecture(solution);
            generateCode(solution);
            generateDemo(solution);
            generateScope(solution);
            generateExport(solution);
            
            // Re-render mermaid diagrams
            mermaid.run({
                querySelector: '.mermaid',
            });
        }
        
        // Add product to solution
        function addProduct(productId) {
            if (!currentSolution) return;
            
            if (!currentSolution.products.includes(productId)) {
                currentSolution.products.push(productId);
                
                // Recalculate complexity based on new product count
                const productCount = currentSolution.products.length;
                if (productCount <= 2) {
                    currentSolution.complexity = 'low';
                    currentSolution.timeline.weeks = 3;
                } else if (productCount >= 5) {
                    currentSolution.complexity = 'high';
                    currentSolution.timeline.weeks = 10;
                } else {
                    currentSolution.complexity = 'medium';
                    currentSolution.timeline.weeks = 6;
                }
                
                // Update overview to show changes
                generateOverview(currentSolution);
                
                // Show notification
                showNotification(`‚úÖ ${productInfo[productId].name} added! Click "Regenerate Guide" to update.`);
            }
        }
        
        // Remove product from solution
        function removeProduct(productId) {
            if (!currentSolution) return;
            
            // Always keep at least one product
            if (currentSolution.products.length <= 1) {
                showNotification('‚ö†Ô∏è You must have at least one product selected.');
                return;
            }
            
            const index = currentSolution.products.indexOf(productId);
            if (index > -1) {
                currentSolution.products.splice(index, 1);
                
                // Recalculate complexity based on new product count
                const productCount = currentSolution.products.length;
                if (productCount <= 2) {
                    currentSolution.complexity = 'low';
                    currentSolution.timeline.weeks = 3;
                } else if (productCount >= 5) {
                    currentSolution.complexity = 'high';
                    currentSolution.timeline.weeks = 10;
                } else {
                    currentSolution.complexity = 'medium';
                    currentSolution.timeline.weeks = 6;
                }
                
                // Update overview to show changes
                generateOverview(currentSolution);
                
                // Show notification
                showNotification(`üóëÔ∏è ${productInfo[productId].name} removed! Click "Regenerate Guide" to update.`);
            }
        }
        
        // Regenerate entire guide with current product selection
        function regenerateGuide() {
            if (!currentSolution) return;
            
            showNotification('üîÑ Regenerating guide with updated products...');
            
            // Regenerate all sections
            generateArchitecture(currentSolution);
            generateCode(currentSolution);
            generateScope(currentSolution);
            generateExport(currentSolution);
            
            // Re-render mermaid diagrams
            setTimeout(() => {
                mermaid.run({
                    querySelector: '.mermaid',
                });
                showNotification('‚úÖ Guide regenerated successfully!');
            }, 100);
        }
        
        // Show notification
        function showNotification(message) {
            // Remove any existing notification
            const existing = document.querySelector('.notification-toast');
            if (existing) existing.remove();
            
            // Create notification
            const notification = document.createElement('div');
            notification.className = 'notification-toast';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Alias for demo
        function showToast(message, type) {
            showNotification(message);
        }
        
        // Product metadata
        const productInfo = {
            auth: { 
                icon: 'üîê', 
                name: 'Auth', 
                desc: 'Instant account verification & routing numbers',
                docs: 'https://plaid.com/docs/auth/'
            },
            transactions: { 
                icon: 'üí≥', 
                name: 'Transactions', 
                desc: 'Real-time transaction data with enrichment',
                docs: 'https://plaid.com/docs/transactions/'
            },
            balance: { 
                icon: 'üí∞', 
                name: 'Balance', 
                desc: 'Real-time account balances (automatically available - NOT in products array)',
                docs: 'https://plaid.com/docs/balance/'
            },
            income: { 
                icon: 'üíµ', 
                name: 'Income', 
                desc: 'Income & employment verification',
                docs: 'https://plaid.com/docs/income/'
            },
            signal: { 
                icon: '‚ö†Ô∏è', 
                name: 'Signal', 
                desc: 'ACH return risk assessment',
                docs: 'https://plaid.com/docs/signal/'
            },
            transfer: { 
                icon: '‚ö°', 
                name: 'Transfer', 
                desc: 'End-to-end money movement',
                docs: 'https://plaid.com/docs/transfer/'
            },
            identity_verification: { 
                icon: 'üÜî', 
                name: 'Identity Verification', 
                desc: 'KYC/AML compliance (SEPARATE flow from bank linking - requires template_id)',
                docs: 'https://plaid.com/docs/identity-verification/'
            },
            assets: { 
                icon: 'üìä', 
                name: 'Assets', 
                desc: 'Asset verification for underwriting',
                docs: 'https://plaid.com/docs/assets/'
            },
            check: { 
                icon: '‚úÖ', 
                name: 'Consumer Report', 
                desc: 'FCRA-compliant credit decisioning',
                docs: 'https://plaid.com/docs/check/'
            }
        };
        
        // Generate overview
        function generateOverview(solution) {
            const content = document.getElementById('overviewContent');
            
            const productCards = solution.products.map(prodId => {
                const prod = productInfo[prodId];
                return `
                    <div class="product-card selected" onclick="removeProduct('${prodId}')" title="Click to remove">
                        <div class="product-badge">‚úì</div>
                        <div class="product-icon">${prod.icon}</div>
                        <div class="product-name">${prod.name}</div>
                        <div class="product-desc">${prod.desc}</div>
                    </div>
                `;
            }).join('');
            
            // Get available products (not currently selected)
            const allProductIds = Object.keys(productInfo);
            const availableProducts = allProductIds.filter(id => !solution.products.includes(id));
            
            const availableCards = availableProducts.map(prodId => {
                const prod = productInfo[prodId];
                return `
                    <div class="product-card available" onclick="addProduct('${prodId}')" title="Click to add">
                        <div class="product-badge">+</div>
                        <div class="product-icon">${prod.icon}</div>
                        <div class="product-name">${prod.name}</div>
                        <div class="product-desc">${prod.desc}</div>
                    </div>
                `;
            }).join('');
            
            content.innerHTML = `
                <div class="info-box">
                    <h3>üìù Your Use Case</h3>
                    <p>${solution.useCase}</p>
                </div>
                
                <div class="products-header">
                    <h3 class="section-header" style="margin: 0;">Selected Products (${solution.products.length})</h3>
                    <button class="regenerate-button" onclick="regenerateGuide()">
                        üîÑ Regenerate Guide
                    </button>
                </div>
                <div class="info-box" style="background: linear-gradient(135deg, #E6E6FF 0%, #F9DBFF 100%); border-left-color: #8B8BF9;">
                    <p style="margin: 0; font-size: 14px;">
                        <strong>üí° Tip:</strong> Click on any product below to remove it, or add new products from the "Available Products" section.
                    </p>
                </div>
                <div class="product-grid">
                    ${productCards}
                </div>
                
                <div class="info-box" style="background: linear-gradient(135deg, #E8FED7 0%, #D8FEF3 100%); border-left-color: #46DA10;">
                    <h3>‚ú® Why These Products?</h3>
                    <p>Based on your use case, this combination provides:</p>
                    <ul>
                        ${getProductReasons(solution.products)}
                    </ul>
                </div>
                
                ${availableProducts.length > 0 ? `
                    <div class="add-products-section">
                        <h3 class="section-header">Available Products to Add (${availableProducts.length})</h3>
                        <div class="info-box" style="background: linear-gradient(135deg, #FFF6D8 0%, #FFE6E6 100%); border-left-color: #EBCB00;">
                            <p style="margin: 0; font-size: 14px;">
                                <strong>‚ûï Add more products:</strong> Click on any product below to add it to your solution. The guide will update when you click "Regenerate Guide".
                            </p>
                        </div>
                        <div class="product-grid">
                            ${availableCards}
                        </div>
                    </div>
                ` : ''}
                
                <div class="doc-links">
                    ${solution.products.map(prodId => {
                        const prod = productInfo[prodId];
                        return `<a href="${prod.docs}" target="_blank" class="doc-link">üìñ ${prod.name} Docs</a>`;
                    }).join('')}
                </div>
            `;
        }
        
        // Get product reasons
        function getProductReasons(products) {
            const reasons = [];
            
            // Note: Link is not included - it's the UI component, not a product
            if (products.includes('auth')) {
                reasons.push('<li><strong>Auth:</strong> Instant verification (no micro-deposits) with account/routing numbers</li>');
            }
            if (products.includes('transactions')) {
                reasons.push('<li><strong>Transactions:</strong> Real-time transaction data with 95% auto-categorization</li>');
            }
            if (products.includes('balance')) {
                reasons.push('<li><strong>Balance:</strong> Real-time balance checks to prevent NSF/returns</li>');
            }
            if (products.includes('income')) {
                reasons.push('<li><strong>Income:</strong> Automated income verification without manual paystubs</li>');
            }
            if (products.includes('signal')) {
                reasons.push('<li><strong>Signal:</strong> Reduce ACH returns by up to 50% with ML-powered risk scores</li>');
            }
            if (products.includes('transfer')) {
                reasons.push('<li><strong>Transfer:</strong> Complete payment infrastructure with reconciliation</li>');
            }
            if (products.includes('identity_verification')) {
                reasons.push('<li><strong>Identity Verification:</strong> KYC/AML compliance with document verification</li>');
            }
            if (products.includes('assets')) {
                reasons.push('<li><strong>Assets:</strong> Comprehensive asset reports for underwriting</li>');
            }
            if (products.includes('check')) {
                reasons.push('<li><strong>Consumer Report:</strong> FCRA-compliant credit decisioning with banking data</li>');
            }
            
            return reasons.join('');
        }
        
        // Generate architecture
        function generateArchitecture(solution) {
            const content = document.getElementById('architectureContent');
            const diagrams = generateMermaidDiagram(solution.products);
            
            const hasIDV = solution.products.includes('identity_verification');
            const hasBankProducts = solution.products.filter(p => p !== 'identity_verification' && p !== 'balance').length > 0;
            
            let diagramsHTML = '';
            
            // If we have both bank linking and IDV, show both diagrams separately
            if (hasBankProducts && hasIDV) {
                diagramsHTML = `
                    <h3 class="section-header" style="margin-top: 0;">Flow 1: Bank Account Linking</h3>
                    <div class="info-box">
                        <p style="margin: 0;">This flow connects user bank accounts to retrieve financial data (transactions, balances, etc.)</p>
                    </div>
                    <div class="diagram-container">
                        <div class="mermaid">
${diagrams.bankDiagram}
                        </div>
                    </div>
                    
                    <h3 class="section-header" style="margin-top: 40px;">Flow 2: Identity Verification (Separate)</h3>
                    <div class="info-box" style="background: linear-gradient(135deg, #E6E6FF 0%, #F9DBFF 100%); border-left-color: #8B8BF9;">
                        <p style="margin: 0;"><strong>‚ö†Ô∏è Important:</strong> IDV is a completely separate flow from bank linking. It does not create an access_token.</p>
                    </div>
                    <div class="diagram-container">
                        <div class="mermaid">
${diagrams.idvDiagram}
                        </div>
                    </div>
                `;
            } else if (hasBankProducts) {
                diagramsHTML = `
                    <div class="diagram-container">
                        <div class="mermaid">
${diagrams.bankDiagram}
                        </div>
                    </div>
                `;
            } else if (hasIDV) {
                diagramsHTML = `
                    <div class="diagram-container">
                        <div class="mermaid">
${diagrams.idvDiagram}
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = `
                <div class="info-box">
                    <h3>üèóÔ∏è Integration Flow${hasBankProducts && hasIDV ? 's' : ''}</h3>
                    <p>${hasBankProducts && hasIDV ? 
                        'Your solution requires TWO separate integration flows. Each uses different endpoints and returns different data.' : 
                        'This sequence diagram shows the complete API flow for your use case.'}</p>
                </div>
                
                ${diagramsHTML}
                
                <div class="info-box" style="background: linear-gradient(135deg, #FFF6D8 0%, #F9DBFF 100%); border-left-color: #EBCB00;">
                    <h3>üí° Architecture Notes</h3>
                    <ul>
                        <li><strong>Link Token:</strong> Always create on-demand from your backend (never reuse)</li>
                        ${hasBankProducts ? '<li><strong>Access Token:</strong> Store securely - it\'s the key to all financial data</li>' : ''}
                        ${hasIDV ? '<li><strong>IDV:</strong> Uses identity_verification_id, NOT access_token</li>' : ''}
                        <li><strong>Webhooks:</strong> Essential for real-time updates (configure in Dashboard)</li>
                        ${hasBankProducts ? '<li><strong>Error Handling:</strong> Use Update Mode for broken connections</li>' : ''}
                    </ul>
                </div>
            `;
        }
        
        // Generate Mermaid diagram
        function generateMermaidDiagram(products) {
            const hasIDV = products.includes('identity_verification');
            const bankProducts = products.filter(p => p !== 'identity_verification' && p !== 'balance' && p !== 'link');
            
            let bankDiagram = '';
            let idvDiagram = '';
            
            // Generate bank linking diagram if we have bank products
            if (bankProducts.length > 0) {
                // Products list for the diagram (excluding balance)
                const productsList = bankProducts.slice(0, 3).join(', ');
                
                bankDiagram = `sequenceDiagram
    autonumber
    participant USER as User
    participant APP as App (Frontend)
    participant BACKEND as Backend
    participant PLAID as Plaid API
    
    Note over USER,APP: Initiate Connection
    APP->>USER: Show "Connect Bank" button
    USER->>APP: Click button
    
    Note over APP,PLAID: Create Link Token
    APP->>BACKEND: Request link_token
    BACKEND->>PLAID: POST /link/token/create
    PLAID-->>BACKEND: link_token
    BACKEND-->>APP: Return link_token
    
    Note over USER,PLAID: Launch Link
    APP->>APP: Initialize Link
    APP->>USER: Show Link modal
    USER->>PLAID: Authenticate with bank
    PLAID->>PLAID: Verify credentials
    PLAID-->>APP: public_token
    
    Note over APP,PLAID: Exchange Token
    APP->>BACKEND: Send public_token
    BACKEND->>PLAID: POST /item/public_token/exchange
    PLAID-->>BACKEND: access_token
    BACKEND->>BACKEND: Store securely
`;
                
                // Add product-specific flows for bank products
                if (products.includes('auth')) {
                    bankDiagram += `
    Note over BACKEND,PLAID: Get Account Numbers
    BACKEND->>PLAID: POST /auth/get
    PLAID-->>BACKEND: account + routing
`;
                }
                
                if (products.includes('balance')) {
                    bankDiagram += `
    Note over BACKEND,PLAID: Check Balance
    BACKEND->>PLAID: POST /accounts/balance/get
    PLAID-->>BACKEND: Balance data
`;
                }
                
                if (products.includes('transactions')) {
                    bankDiagram += `
    Note over BACKEND,PLAID: Fetch Transactions
    BACKEND->>PLAID: POST /transactions/sync
    PLAID-->>BACKEND: transactions[]
    PLAID->>BACKEND: SYNC_UPDATES webhook
    BACKEND->>PLAID: POST /transactions/sync
`;
                }
                
                if (products.includes('signal')) {
                    bankDiagram += `
    Note over BACKEND,PLAID: Evaluate Risk
    BACKEND->>PLAID: POST /signal/evaluate
    PLAID-->>BACKEND: risk_score
    BACKEND->>BACKEND: Approve/reject
`;
                }
                
                if (products.includes('transfer')) {
                    bankDiagram += `
    Note over BACKEND,PLAID: Initiate Transfer
    BACKEND->>PLAID: POST /transfer/authorization/create
    PLAID-->>BACKEND: authorization_id
    BACKEND->>PLAID: POST /transfer/create
    PLAID-->>BACKEND: transfer_id
    PLAID->>BACKEND: TRANSFER_EVENTS webhook
`;
                }
                
                if (products.includes('income')) {
                    bankDiagram += `
    Note over BACKEND,PLAID: Verify Income
    BACKEND->>PLAID: POST /user/create
    PLAID-->>BACKEND: user_token
    BACKEND->>PLAID: POST /link/token/create
    PLAID-->>BACKEND: link_token
    PLAID->>BACKEND: INCOME_READY webhook
    BACKEND->>PLAID: POST /income/verification/paystubs/get
    PLAID-->>BACKEND: income_report
`;
                }
                
                bankDiagram += `
    
    Note over APP,USER: Display Results
    BACKEND-->>APP: Send data
    APP->>USER: Show accounts
`;
            }
            
            // Generate Identity Verification diagram (completely separate)
            if (hasIDV) {
                idvDiagram = `sequenceDiagram
    autonumber
    participant USER as User
    participant APP as App (Frontend)
    participant BACKEND as Backend
    participant PLAID as Plaid API
    
    Note over USER,APP: Initiate Verification
    APP->>USER: Show "Verify Identity" button
    USER->>APP: Click button
    
    Note over APP,BACKEND: Create IDV Session
    APP->>BACKEND: Request IDV link_token
    BACKEND->>PLAID: POST /identity_verification/create
    PLAID-->>BACKEND: idv_id
    
    Note over BACKEND,PLAID: Create IDV Link Token
    BACKEND->>PLAID: POST /link/token/create
    PLAID-->>BACKEND: link_token
    BACKEND-->>APP: Return link_token
    
    Note over USER,PLAID: Complete Verification
    APP->>APP: Initialize Link (IDV)
    APP->>USER: Show IDV modal
    USER->>PLAID: Upload ID
    USER->>PLAID: Take selfie
    PLAID->>PLAID: Verify documents
    PLAID->>PLAID: Match face
    PLAID-->>APP: onSuccess
    
    Note over PLAID,BACKEND: Webhook Notification
    PLAID->>BACKEND: IDENTITY_VERIFICATION
    
    Note over BACKEND,PLAID: Get Results
    BACKEND->>PLAID: GET /identity_verification/get
    PLAID-->>BACKEND: status + data
    BACKEND->>BACKEND: Store result
    
    Note over APP,USER: Show Status
    BACKEND-->>APP: Complete
    APP->>USER: Show status
`;
            }
            
            return {
                bankDiagram: bankDiagram,
                idvDiagram: idvDiagram
            };
        }
        
        // Generate code examples
        function generateCode(solution) {
            const content = document.getElementById('codeContent');
            const language = document.getElementById('languageSelect').value;
            
            const showBoth = language === 'both';
            const nodeCode = generateNodeCode(solution.products);
            const pythonCode = generatePythonCode(solution.products);
            
            content.innerHTML = `
                <div class="info-box">
                    <h3>üíª Ready-to-Use Code</h3>
                    <p>Copy these code examples directly into your application. All examples use the latest Plaid API.</p>
                </div>
                
                ${showBoth ? `
                    <div class="code-header">
                        <h3 style="color: #05565C;">Code Examples</h3>
                        <div class="language-tabs">
                            <button class="lang-tab active" onclick="switchLanguage('node')">Node.js</button>
                            <button class="lang-tab" onclick="switchLanguage('python')">Python</button>
                        </div>
                    </div>
                ` : `
                    <h3 style="color: #05565C; margin-bottom: 16px;">${language === 'node' ? 'Node.js' : 'Python'} Implementation</h3>
                `}
                
                <div id="nodeCode" class="${showBoth ? 'code-section active' : ''}">
                    ${generateCodeBlocks(nodeCode, 'node')}
                </div>
                
                <div id="pythonCode" class="${showBoth ? 'code-section' : 'code-section active'}" style="${!showBoth && language === 'python' ? 'display: block;' : ''}">
                    ${generateCodeBlocks(pythonCode, 'python')}
                </div>
                
                <div class="info-box" style="background: linear-gradient(135deg, #E6E6FF 0%, #F9DBFF 100%); border-left-color: #8B8BF9;">
                    <h3>üîë Getting Started</h3>
                    <ul>
                        <li><strong>Sandbox Keys:</strong> Get your client_id and secret from <a href="https://dashboard.plaid.com/developers/keys" target="_blank" style="color: #0B7BBC; font-weight: 600;">Plaid Dashboard</a></li>
                        <li><strong>Environment:</strong> Start in 'sandbox', then move to 'development', then 'production'</li>
                        <li><strong>Webhooks:</strong> Use ngrok for local testing: <code style="background: #E6E6FF; padding: 2px 6px; border-radius: 4px;">ngrok http 3000</code></li>
                    </ul>
                </div>
            `;
        }
        
        // Switch language
        function switchLanguage(lang) {
            document.querySelectorAll('.lang-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('nodeCode').classList.remove('active');
            document.getElementById('pythonCode').classList.remove('active');
            
            if (lang === 'node') {
                document.getElementById('nodeCode').classList.add('active');
            } else {
                document.getElementById('pythonCode').classList.add('active');
            }
        }
        
        // Generate code blocks
        function generateCodeBlocks(codeObject, lang) {
            let html = '';
            
            for (const [title, code] of Object.entries(codeObject)) {
                const codeId = 'code-' + Math.random().toString(36).substr(2, 9);
                html += `
                    <h4 style="color: #05565C; margin: 24px 0 12px;">${title}</h4>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyCodeFromPre(this)">
                            Copy Code
                        </button>
                        <pre id="${codeId}">${escapeHtml(code)}</pre>
                    </div>
                `;
            }
            
            return html;
        }
        
        // Generate Node.js code
        function generateNodeCode(products) {
            const code = {};
            
            // Separate Identity Verification from other products
            const hasIDV = products.includes('identity_verification');
            const bankProducts = products.filter(p => p !== 'identity_verification' && p !== 'balance' && p !== 'link');
            
            code['1. Install & Setup'] = `npm install plaid

// server.js
const { Configuration, PlaidApi, PlaidEnvironments } = require('plaid');

const configuration = new Configuration({
  basePath: PlaidEnvironments.sandbox,
  baseOptions: {
    headers: {
      'PLAID-CLIENT-ID': process.env.PLAID_CLIENT_ID,
      'PLAID-SECRET': process.env.PLAID_SECRET,
    },
  },
});

const plaidClient = new PlaidApi(configuration);`;
            
            // Only generate bank linking code if there are bank products
            if (bankProducts.length > 0) {
                code['2. Create Link Token (Bank Linking)'] = `app.post('/api/create_link_token', async (req, res) => {
  try {
    const request = {
      user: { client_user_id: req.user.id },
      client_name: 'Your App Name',
      products: [${bankProducts.map(p => `'${p}'`).join(', ')}], // 'link' is the UI component (not a product). 'balance' auto-available.
      country_codes: ['US'],
      language: 'en',
      webhook: 'https://your-app.com/webhook',${products.includes('transactions') ? `
      transactions: {
        days_requested: 180
      },` : ''}
    };
    
    const response = await plaidClient.linkTokenCreate(request);
    res.json({ link_token: response.data.link_token });
  } catch (error) {
    console.error('Error creating link token:', error);
    res.status(500).json({ error: error.message });
  }
});`;
            }
            
            // Generate separate IDV flow if needed
            if (hasIDV) {
                code['2. Create Identity Verification Session'] = `// IMPORTANT: Identity Verification is a SEPARATE flow from bank linking
// Step 1: Create IDV session (recommended for prefilling data)
app.post('/api/create_idv_session', async (req, res) => {
  try {
    const request = {
      client_user_id: req.user.id,
      is_shareable: true,
      template_id: process.env.IDV_TEMPLATE_ID, // Get from Dashboard
      gave_consent: true,
      // Optional: Prefill user data
      user: {
        email_address: req.body.email,
        phone_number: req.body.phone,
        date_of_birth: req.body.dob,
        name: {
          given_name: req.body.firstName,
          family_name: req.body.lastName
        },
        address: {
          street: req.body.street,
          city: req.body.city,
          region: req.body.state,
          postal_code: req.body.zip,
          country: 'US'
        }
      }
    };
    
    const response = await plaidClient.identityVerificationCreate(request);
    res.json({ idv_id: response.data.id });
  } catch (error) {
    console.error('Error creating IDV session:', error);
    res.status(500).json({ error: error.message });
  }
});

// Step 2: Create Link Token for IDV
app.post('/api/create_idv_link_token', async (req, res) => {
  try {
    const request = {
      user: { client_user_id: req.user.id },
      client_name: 'Your App Name',
      products: ['identity_verification'], // SEPARATE from bank products
      country_codes: ['US'],
      language: 'en',
      identity_verification: {
        template_id: process.env.IDV_TEMPLATE_ID,
        gave_consent: true
      }
    };
    
    const response = await plaidClient.linkTokenCreate(request);
    res.json({ link_token: response.data.link_token });
  } catch (error) {
    console.error('Error creating IDV link token:', error);
    res.status(500).json({ error: error.message });
  }
});`;
            }
            
            // Frontend code depends on which flow(s) we have
            let frontendStep = 3;
            if (bankProducts.length > 0) {
                code[`${frontendStep}. Initialize Link (Frontend - Bank Linking)`] = `<!-- Include Plaid Link SDK -->
<script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"><\/script>

<script>
  // Fetch link token from your backend
  const response = await fetch('/api/create_link_token');
  const { link_token } = await response.json();
  
  // Initialize Link for bank account connection
  const handler = Plaid.create({
    token: link_token,
    onSuccess: async (public_token, metadata) => {
      // Send public_token to backend
      await fetch('/api/exchange_token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ public_token })
      });
      console.log('Account connected!', metadata);
    },
    onExit: (error, metadata) => {
      if (error) console.error('Link error:', error);
    }
  });
  
  // Open Link
  handler.open();
<\/script>`;
                frontendStep++;
            }
            
            if (hasIDV) {
                code[`${frontendStep}. Initialize Link (Frontend - Identity Verification)`] = `<!-- Include Plaid Link SDK -->
<script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"><\/script>

<script>
  // SEPARATE FLOW: Identity Verification uses different link token
  const response = await fetch('/api/create_idv_link_token');
  const { link_token } = await response.json();
  
  // Initialize Link for Identity Verification
  const idvHandler = Plaid.create({
    token: link_token,
    onSuccess: async (public_token, metadata) => {
      // For IDV, link_session_id IS the identity_verification_id
      const idvId = metadata.link_session_id;
      console.log('IDV completed:', idvId);
      
      // Retrieve verification results
      await fetch('/api/get_idv_result', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ idv_id: idvId })
      });
    },
    onExit: (error, metadata) => {
      if (error) console.error('IDV error:', error);
    }
  });
  
  // Open IDV Link
  idvHandler.open();
<\/script>`;
                frontendStep++;
            }
            
            if (bankProducts.length > 0) {
                code[`${frontendStep}. Exchange Public Token (Bank Linking)`] = `app.post('/api/exchange_token', async (req, res) => {
  try {
    const { public_token } = req.body;
    
    const response = await plaidClient.itemPublicTokenExchange({
      public_token: public_token,
    });
    
    const accessToken = response.data.access_token;
    const itemId = response.data.item_id;
    
    // CRITICAL: Store access_token securely in your database
    await db.saveAccessToken(req.user.id, accessToken, itemId);
    
    res.json({ success: true });
  } catch (error) {
    console.error('Error exchanging token:', error);
    res.status(500).json({ error: error.message });
  }
});`;
                frontendStep++;
            }
            
            if (hasIDV) {
                code[`${frontendStep}. Get IDV Results`] = `// Retrieve Identity Verification results
// Note: No access_token for IDV - use identity_verification_id instead
app.post('/api/get_idv_result', async (req, res) => {
  try {
    const { idv_id } = req.body;
    
    const response = await plaidClient.identityVerificationGet({
      identity_verification_id: idv_id
    });
    
    const status = response.data.status; // 'success', 'failed', 'active', etc.
    const steps = response.data.steps;   // Document upload, selfie, etc.
    
    // Check if verification passed
    if (status === 'success') {
      // User is verified!
      const user = response.data.user;
      await db.saveVerifiedUser(req.user.id, {
        verified: true,
        idv_id: idv_id,
        name: user.name,
        dob: user.date_of_birth,
        address: user.address
      });
      res.json({ verified: true, user });
    } else {
      res.json({ verified: false, status, steps });
    }
  } catch (error) {
    console.error('Error getting IDV result:', error);
    res.status(500).json({ error: error.message });
  }
});`;
                frontendStep++;
            }
            
            // Product-specific code
            if (products.includes('transactions')) {
                code['5. Fetch Transactions'] = `// Initial sync
app.post('/api/sync_transactions', async (req, res) => {
  try {
    const accessToken = await db.getAccessToken(req.user.id);
    const cursor = await db.getCursor(req.user.id); // null for first sync
    
    let hasMore = true;
    let currentCursor = cursor;
    
    while (hasMore) {
      const response = await plaidClient.transactionsSync({
        access_token: accessToken,
        cursor: currentCursor,
      });
      
      // Save new/modified transactions
      await db.saveTransactions(response.data.added);
      await db.updateTransactions(response.data.modified);
      await db.deleteTransactions(response.data.removed);
      
      hasMore = response.data.has_more;
      currentCursor = response.data.next_cursor;
    }
    
    // Save cursor for next sync
    await db.saveCursor(req.user.id, currentCursor);
    
    res.json({ success: true });
  } catch (error) {
    console.error('Error syncing transactions:', error);
    res.status(500).json({ error: error.message });
  }
});

// Webhook handler for real-time updates
app.post('/webhook', async (req, res) => {
  const { webhook_type, webhook_code, item_id } = req.body;
  
  if (webhook_code === 'SYNC_UPDATES_AVAILABLE') {
    // Trigger transaction sync
    const userId = await db.getUserByItemId(item_id);
    await syncTransactionsForUser(userId);
  }
  
  res.sendStatus(200);
});`;
            }
            
            if (products.includes('balance')) {
                code[`${frontendStep}. Check Real-Time Balance`] = `// Balance is automatically available with any product - NOT included in products array!
app.get('/api/balance', async (req, res) => {
  try {
    const accessToken = await db.getAccessToken(req.user.id);
    
    const response = await plaidClient.accountsBalanceGet({
      access_token: accessToken,
    });
    
    const accounts = response.data.accounts.map(account => ({
      id: account.account_id,
      name: account.name,
      current: account.balances.current,
      available: account.balances.available,
      currency: account.balances.iso_currency_code
    }));
    
    res.json({ accounts });
  } catch (error) {
    console.error('Error getting balance:', error);
    res.status(500).json({ error: error.message });
  }
});`;
            }
            
            if (products.includes('signal')) {
                code[`${Object.keys(code).length + 1}. Evaluate Payment Risk`] = `app.post('/api/evaluate_payment', async (req, res) => {
  try {
    const { accountId, amount } = req.body;
    const accessToken = await db.getAccessToken(req.user.id);
    
    const response = await plaidClient.signalEvaluate({
      access_token: accessToken,
      account_id: accountId,
      client_transaction_id: \`txn-\${Date.now()}\`,
      amount: amount,
    });
    
    const riskScore = response.data.core_attributes.risk_score; // 0-99
    const action = response.data.core_attributes.recommended_action;
    
    if (action === 'approve') {
      // Low risk - proceed with payment
      res.json({ approved: true, riskScore });
    } else if (action === 'review') {
      // Medium risk - manual review
      res.json({ approved: false, needsReview: true, riskScore });
    } else {
      // High risk - reject
      res.json({ approved: false, rejected: true, riskScore });
    }
  } catch (error) {
    console.error('Error evaluating payment:', error);
    res.status(500).json({ error: error.message });
  }
});`;
            }
            
            return code;
        }
        
        // Generate Python code
        function generatePythonCode(products) {
            const code = {};
            
            // Separate Identity Verification from other products
            const hasIDV = products.includes('identity_verification');
            const bankProducts = products.filter(p => p !== 'identity_verification' && p !== 'balance' && p !== 'link');
            
            code['1. Install & Setup'] = `pip install plaid-python

# app.py
import os
import plaid
from plaid.api import plaid_api
from plaid.model.link_token_create_request import LinkTokenCreateRequest
from plaid.model.link_token_create_request_user import LinkTokenCreateRequestUser
from plaid.model.products import Products

configuration = plaid.Configuration(
    host=plaid.Environment.Sandbox,
    api_key={
        'clientId': os.environ['PLAID_CLIENT_ID'],
        'secret': os.environ['PLAID_SECRET'],
    }
)

api_client = plaid.ApiClient(configuration)
plaid_client = plaid_api.PlaidApi(api_client)`;
            
            let pythonStep = 2;
            
            // Bank linking flow
            if (bankProducts.length > 0) {
                code[`${pythonStep}. Create Link Token (Bank Linking)`] = `@app.route('/api/create_link_token', methods=['POST'])
def create_link_token():
    try:
        request = LinkTokenCreateRequest(
            user=LinkTokenCreateRequestUser(client_user_id=session['user_id']),
            client_name='Your App Name',
            products=[${bankProducts.map(p => `Products('${p}')`).join(', ')}],  # 'link' = UI component (not a product). 'balance' = auto-available
            country_codes=['US'],
            language='en',
            webhook='https://your-app.com/webhook'${products.includes('transactions') ? `,
            transactions=LinkTokenCreateRequestTransactions(
                days_requested=180
            )` : ''}
        )
        
        response = plaid_client.link_token_create(request)
        return jsonify({'link_token': response.link_token})
    except plaid.ApiException as e:
        return jsonify({'error': str(e)}), 500`;
                pythonStep++;
            }
            
            // IDV flow
            if (hasIDV) {
                code[`${pythonStep}. Create Identity Verification (Separate Flow)`] = `# IMPORTANT: Identity Verification is SEPARATE from bank linking
from plaid.model.identity_verification_create_request import IdentityVerificationCreateRequest

@app.route('/api/create_idv_link_token', methods=['POST'])
def create_idv_link_token():
    try:
        request = LinkTokenCreateRequest(
            user=LinkTokenCreateRequestUser(client_user_id=session['user_id']),
            client_name='Your App Name',
            products=[Products('identity_verification')],  # SEPARATE from bank products
            country_codes=['US'],
            language='en',
            identity_verification=LinkTokenCreateRequestIdentityVerification(
                template_id=os.environ['IDV_TEMPLATE_ID'],
                gave_consent=True
            )
        )
        
        response = plaid_client.link_token_create(request)
        return jsonify({'link_token': response.link_token})
    except plaid.ApiException as e:
        return jsonify({'error': str(e)}), 500`;
                pythonStep++;
            }
            
            if (bankProducts.length > 0) {
                code[`${pythonStep}. Exchange Public Token (Bank Linking)`] = `@app.route('/api/exchange_token', methods=['POST'])
def exchange_token():
    try:
        public_token = request.json['public_token']
        
        exchange_request = ItemPublicTokenExchangeRequest(
            public_token=public_token
        )
        response = plaid_client.item_public_token_exchange(exchange_request)
        
        access_token = response.access_token
        item_id = response.item_id
        
        # CRITICAL: Store access_token securely in database
        db.save_access_token(session['user_id'], access_token, item_id)
        
        return jsonify({'success': True})
    except plaid.ApiException as e:
        return jsonify({'error': str(e)}), 500`;
                pythonStep++;
            }
            
            if (products.includes('transactions')) {
                code['4. Fetch Transactions'] = `@app.route('/api/sync_transactions', methods=['POST'])
def sync_transactions():
    try:
        access_token = db.get_access_token(session['user_id'])
        cursor = db.get_cursor(session['user_id'])  # None for first sync
        
        has_more = True
        
        while has_more:
            request = TransactionsSyncRequest(
                access_token=access_token,
                cursor=cursor
            )
            response = plaid_client.transactions_sync(request)
            
            # Save transactions
            db.save_transactions(response.added)
            db.update_transactions(response.modified)
            db.delete_transactions(response.removed)
            
            has_more = response.has_more
            cursor = response.next_cursor
        
        # Save cursor
        db.save_cursor(session['user_id'], cursor)
        
        return jsonify({'success': True})
    except plaid.ApiException as e:
        return jsonify({'error': str(e)}), 500

@app.route('/webhook', methods=['POST'])
def webhook():
    data = request.json
    
    if data['webhook_code'] == 'SYNC_UPDATES_AVAILABLE':
        # Trigger transaction sync
        user_id = db.get_user_by_item_id(data['item_id'])
        sync_transactions_for_user(user_id)
    
    return '', 200`;
            }
            
            if (products.includes('balance')) {
                code[`${Object.keys(code).length + 1}. Check Balance`] = `@app.route('/api/balance', methods=['GET'])
def get_balance():
    try:
        access_token = db.get_access_token(session['user_id'])
        
        request = AccountsBalanceGetRequest(access_token=access_token)
        response = plaid_client.accounts_balance_get(request)
        
        accounts = []
        for account in response.accounts:
            accounts.append({
                'id': account.account_id,
                'name': account.name,
                'current': account.balances.current,
                'available': account.balances.available,
                'currency': account.balances.iso_currency_code
            })
        
        return jsonify({'accounts': accounts})
    except plaid.ApiException as e:
        return jsonify({'error': str(e)}), 500`;
            }
            
            if (products.includes('signal')) {
                code[`${Object.keys(code).length + 1}. Evaluate Payment Risk`] = `@app.route('/api/evaluate_payment', methods=['POST'])
def evaluate_payment():
    try:
        access_token = db.get_access_token(session['user_id'])
        account_id = request.json['account_id']
        amount = request.json['amount']
        
        signal_request = SignalEvaluateRequest(
            access_token=access_token,
            account_id=account_id,
            client_transaction_id=f'txn-{int(time.time())}',
            amount=amount
        )
        
        response = plaid_client.signal_evaluate(signal_request)
        
        risk_score = response.core_attributes.risk_score  # 0-99
        action = response.core_attributes.recommended_action
        
        if action == 'approve':
            return jsonify({'approved': True, 'risk_score': risk_score})
        elif action == 'review':
            return jsonify({'approved': False, 'needs_review': True, 'risk_score': risk_score})
        else:
            return jsonify({'approved': False, 'rejected': True, 'risk_score': risk_score})
    except plaid.ApiException as e:
        return jsonify({'error': str(e)}), 500`;
            }
            
            return code;
        }
        
        // Generate demo interface
        function generateDemo(solution) {
            const content = document.getElementById('demoContent');
            const products = solution.products;
            const hasIDV = products.includes('identity_verification');
            const bankProducts = products.filter(p => p !== 'identity_verification' && p !== 'balance' && p !== 'link');
            
            content.innerHTML = `
                <div class="info-box">
                    <h3>üöÄ Test Your Integration</h3>
                    <p>Run a live demo of the Plaid integration with your credentials. This will execute the real API sequence and display the results.</p>
                </div>
                
                <div class="info-box" style="background: linear-gradient(135deg, #FFF6D8 0%, #F9DBFF 100%); border-left-color: #EBCB00;">
                    <h3>üì¶ Products to Test</h3>
                    ${products && products.length > 0 ? `
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px;">
                            ${products.map(p => `<span style="background: #05565C; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; display: inline-block; margin: 4px;">${productInfo[p]?.name || p}</span>`).join('')}
                        </div>
                    ` : `
                        <p style="margin-top: 12px; color: #666;">No products detected. Go back to Overview tab to see recommended products.</p>
                    `}
                </div>
                
                <div style="background: white; border-radius: 12px; padding: 24px; margin: 20px 0; border: 2px solid #D8FEF3;">
                    <h3 style="margin-top: 0;">‚öôÔ∏è Configuration</h3>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #05565C;">
                            Plaid Client ID <a href="https://dashboard.plaid.com/developers/keys" target="_blank" style="font-size: 12px; color: #088181; font-weight: 400;">(Get from Dashboard ‚Üí)</a>
                        </label>
                        <input 
                            type="text" 
                            id="demoClientId" 
                            placeholder="Your client_id" 
                            style="width: 100%; padding: 12px; border: 2px solid #D8FEF3; border-radius: 8px; font-size: 16px; font-family: 'Courier New', monospace;"
                        />
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #05565C;">
                            Plaid Secret
                        </label>
                        <input 
                            type="password" 
                            id="demoSecret" 
                            placeholder="Your secret (sandbox or development)" 
                            style="width: 100%; padding: 12px; border: 2px solid #D8FEF3; border-radius: 8px; font-size: 16px; font-family: 'Courier New', monospace;"
                        />
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #05565C;">
                            Environment
                        </label>
                        <select id="demoEnvironment" style="width: 100%; padding: 12px; border: 2px solid #D8FEF3; border-radius: 8px; font-size: 16px;">
                            <option value="sandbox">Sandbox</option>
                            <option value="development">Development</option>
                        </select>
                    </div>
                    
                    <details style="margin-bottom: 16px;">
                        <summary style="cursor: pointer; color: #088181; font-weight: 600; font-size: 14px;">‚öôÔ∏è Advanced: Custom Backend URL</summary>
                        <div style="margin-top: 12px;">
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #05565C; font-size: 14px;">
                                Backend Proxy URL
                            </label>
                            <input 
                                type="text" 
                                id="demoBackendUrl" 
                                placeholder="https://plaid-architect-backend.onrender.com/api" 
                                value="https://plaid-architect-backend.onrender.com/api"
                                style="width: 100%; padding: 10px; border: 2px solid #D8FEF3; border-radius: 8px; font-size: 14px; font-family: 'Courier New', monospace;"
                            />
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">Change this if you deployed your own backend</div>
                        </div>
                    </details>
                    
                    <button 
                        onclick="startDemo()" 
                        class="primary-button"
                        style="width: 100%; padding: 16px; background: linear-gradient(135deg, #10D1B7 0%, #088181 100%); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s;"
                    >
                        üöÄ Launch Plaid Link Demo
                    </button>
                </div>
                
                <div id="demoResults" style="display: none;">
                    <h3 class="section-header">üìä Demo Results</h3>
                    <div id="demoResultsContent"></div>
                </div>
                
                <div class="info-box" style="background: linear-gradient(135deg, #E6E6FF 0%, #F9DBFF 100%); border-left-color: #8B8BF9; margin-top: 20px;">
                    <h3>‚ÑπÔ∏è How to Use</h3>
                    <ol style="margin: 12px 0 0 0; padding-left: 20px;">
                        <li style="margin-bottom: 8px;">Enter your Plaid Client ID and Secret above</li>
                        <li style="margin-bottom: 8px;">Click "Launch Plaid Link Demo"</li>
                        <li style="margin-bottom: 8px;">In Link, use Sandbox credentials: <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 4px;">user_good</code> / <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 4px;">pass_good</code></li>
                        <li>View your live data below!</li>
                    </ol>
                </div>
            `;
        }
        
        // Demo state
        let demoAccessToken = null;
        let demoItemId = null;
        
        // Start the demo
        async function startDemo() {
            const backendUrl = document.getElementById('demoBackendUrl').value.trim();
            const clientId = document.getElementById('demoClientId').value.trim();
            const secret = document.getElementById('demoSecret').value.trim();
            const environment = document.getElementById('demoEnvironment').value;
            
            if (!backendUrl) {
                alert('‚ö†Ô∏è Backend URL is required!\n\nPlaid blocks direct browser API calls for security (CORS).\n\nPlease:\n1. Copy the backend code below\n2. Run it locally (npm install, node server.js)\n3. Enter the URL above (http://localhost:3000/api)');
                return;
            }
            
            if (!clientId || !secret) {
                alert('Please enter both Client ID and Secret from your Plaid Dashboard');
                return;
            }
            
            try {
                showToast('Creating Link token...', 'info');
                
                // Create link token
                const linkToken = await createLinkToken(backendUrl, clientId, secret, environment);
                
                // Initialize Plaid Link
                const handler = Plaid.create({
                    token: linkToken,
                    onSuccess: async (public_token, metadata) => {
                        showToast('Link successful! Exchanging token...', 'success');
                        await handleLinkSuccess(public_token, metadata, backendUrl, clientId, secret, environment);
                    },
                    onExit: (err, metadata) => {
                        if (err != null) {
                            showToast('Error: ' + (err.display_message || err.error_message), 'error');
                        }
                    },
                });
                
                handler.open();
                
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
                console.error('Demo error:', error);
            }
        }
        
        // Create link token
        async function createLinkToken(backendUrl, clientId, secret, environment) {
            const products = currentSolution.products.filter(p => p !== 'identity_verification' && p !== 'balance' && p !== 'link');
            
            const response = await fetch(`${backendUrl}/link_token`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    client_id: clientId,
                    secret: secret,
                    user_id: 'demo_user_' + Date.now(),
                    products: products,
                    environment: environment,
                })
            });
            
            if (!response.ok) {
                const error = await response.json().catch(() => ({ error: 'Failed to create link token. Is your backend running?' }));
                throw new Error(error.error_message || error.error || 'Backend connection failed');
            }
            
            const data = await response.json();
            return data.link_token;
        }
        
        // Handle successful Link connection
        async function handleLinkSuccess(publicToken, metadata, backendUrl, clientId, secret, environment) {
            try {
                // Exchange public token
                const exchangeResponse = await fetch(`${backendUrl}/exchange_token`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        client_id: clientId,
                        secret: secret,
                        public_token: publicToken,
                        environment: environment,
                    })
                });
                
                if (!exchangeResponse.ok) {
                    const error = await exchangeResponse.json().catch(() => ({ error: 'Failed to exchange token' }));
                    throw new Error(error.error_message || error.error || 'Token exchange failed');
                }
                
                const exchangeData = await exchangeResponse.json();
                demoAccessToken = exchangeData.access_token;
                demoItemId = exchangeData.item_id;
                
                showToast('Token exchanged! Fetching data...', 'success');
                
                // Fetch data for all products
                await fetchDemoData(backendUrl, clientId, secret, environment, metadata);
                
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
                console.error('Exchange error:', error);
            }
        }
        
        // Fetch data for all products
        async function fetchDemoData(backendUrl, clientId, secret, environment) {
            const results = {};
            const products = currentSolution.products.filter(p => p !== 'identity_verification' && p !== 'link');
            
            try {
                // Auth
                if (products.includes('auth')) {
                    try {
                        const authResponse = await fetch(`${backendUrl}/auth`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                client_id: clientId,
                                secret: secret,
                                access_token: demoAccessToken,
                                environment: environment,
                            })
                        });
                        if (authResponse.ok) {
                            results.auth = await authResponse.json();
                        }
                    } catch (e) { console.log('Auth error:', e); }
                }
                
                // Balance (always available)
                if (products.includes('balance') || products.length > 0) {
                    try {
                        const balanceResponse = await fetch(`${backendUrl}/balance`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                client_id: clientId,
                                secret: secret,
                                access_token: demoAccessToken,
                                environment: environment,
                            })
                        });
                        if (balanceResponse.ok) {
                            results.balance = await balanceResponse.json();
                        }
                    } catch (e) { console.log('Balance error:', e); }
                }
                
                // Transactions
                if (products.includes('transactions')) {
                    try {
                        const txnResponse = await fetch(`${backendUrl}/transactions`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                client_id: clientId,
                                secret: secret,
                                access_token: demoAccessToken,
                                environment: environment,
                            })
                        });
                        if (txnResponse.ok) {
                            results.transactions = await txnResponse.json();
                        }
                    } catch (e) { console.log('Transactions error:', e); }
                }
                
                // Display results
                displayDemoResults(results);
                
            } catch (error) {
                showToast('Error fetching data: ' + error.message, 'error');
                console.error('Fetch error:', error);
            }
        }
        
        // Display demo results
        function displayDemoResults(results) {
            const resultsDiv = document.getElementById('demoResults');
            const resultsContent = document.getElementById('demoResultsContent');
            
            let html = '';
            
            // Auth results
            if (results.auth) {
                const accounts = results.auth.accounts || [];
                const numbers = results.auth.numbers || {};
                html += `
                    <div class="info-box" style="background: linear-gradient(135deg, #D8FEF3 0%, #E6F9FF 100%); border-left-color: #10D1B7;">
                        <h3>‚úÖ Auth - Account Numbers</h3>
                        ${accounts.map(acc => `
                            <div style="background: white; padding: 16px; border-radius: 8px; margin-top: 12px;">
                                <div style="font-weight: 600; color: #05565C; margin-bottom: 8px;">${acc.name}</div>
                                <div style="font-family: 'Courier New', monospace; font-size: 14px;">
                                    <div>Account: ${numbers.ach?.find(n => n.account_id === acc.account_id)?.account || 'N/A'}</div>
                                    <div>Routing: ${numbers.ach?.find(n => n.account_id === acc.account_id)?.routing || 'N/A'}</div>
                                    <div style="color: #666; margin-top: 4px;">Type: ${acc.type} - ${acc.subtype}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Balance results
            if (results.balance) {
                const accounts = results.balance.accounts || [];
                html += `
                    <div class="info-box" style="background: linear-gradient(135deg, #FFF6D8 0%, #F9DBFF 100%); border-left-color: #EBCB00;">
                        <h3>üí∞ Balance - Account Balances</h3>
                        ${accounts.map(acc => `
                            <div style="background: white; padding: 16px; border-radius: 8px; margin-top: 12px;">
                                <div style="font-weight: 600; color: #05565C; margin-bottom: 8px;">${acc.name}</div>
                                <div style="font-size: 24px; font-weight: 700; color: #088181;">
                                    $${acc.balances.current?.toFixed(2) || '0.00'}
                                </div>
                                <div style="color: #666; font-size: 14px; margin-top: 4px;">
                                    Available: $${acc.balances.available?.toFixed(2) || '0.00'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Transaction results
            if (results.transactions) {
                const transactions = results.transactions.added || [];
                html += `
                    <div class="info-box" style="background: linear-gradient(135deg, #E6E6FF 0%, #F9DBFF 100%); border-left-color: #8B8BF9;">
                        <h3>üìä Transactions - Recent Activity (${transactions.length})</h3>
                        ${transactions.slice(0, 10).map(txn => `
                            <div style="background: white; padding: 12px; border-radius: 8px; margin-top: 8px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600; color: #05565C;">${txn.name}</div>
                                    <div style="font-size: 12px; color: #666;">${txn.date}</div>
                                </div>
                                <div style="font-weight: 700; font-size: 18px; color: ${txn.amount > 0 ? '#088181' : '#10D1B7'};">
                                    ${txn.amount > 0 ? '-' : '+'}$${Math.abs(txn.amount).toFixed(2)}
                                </div>
                            </div>
                        `).join('')}
                        ${transactions.length > 10 ? `<div style="text-align: center; margin-top: 12px; color: #666;">...and ${transactions.length - 10} more</div>` : ''}
                    </div>
                `;
            }
            
            if (html === '') {
                html = '<div class="info-box">No data returned. Please try again.</div>';
            }
            
            // Add Raw API Response section
            html += `
                <h3 class="section-header" style="margin-top: 40px;">üîç Raw API Responses</h3>
                <div class="info-box" style="background: linear-gradient(135deg, #F9FFFE 0%, #FAFCFF 100%); border-left-color: #05565C;">
                    <p style="margin-bottom: 16px; color: #05565C;">
                        <strong>üìù Full JSON responses from Plaid APIs</strong> - See exactly what the endpoints return
                    </p>
            `;
            
            // Show raw responses for each product
            if (results.auth) {
                html += `
                    <details style="margin: 16px 0; border: 2px solid #D8FEF3; border-radius: 8px; overflow: hidden;">
                        <summary style="padding: 12px; background: #D8FEF3; cursor: pointer; font-weight: 600; color: #05565C;">
                            üìÑ POST /auth/get - Full Response
                        </summary>
                        <div style="padding: 16px; background: #012E37;">
                            <button class="copy-button" onclick="copyCodeFromPre(this)" style="margin-bottom: 8px;">Copy JSON</button>
                            <pre style="margin: 0; overflow-x: auto; color: #D8FEF3; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.5;">${escapeHtml(JSON.stringify(results.auth, null, 2))}</pre>
                        </div>
                    </details>
                `;
            }
            
            if (results.balance) {
                html += `
                    <details style="margin: 16px 0; border: 2px solid #D8FEF3; border-radius: 8px; overflow: hidden;">
                        <summary style="padding: 12px; background: #D8FEF3; cursor: pointer; font-weight: 600; color: #05565C;">
                            üìÑ POST /accounts/balance/get - Full Response
                        </summary>
                        <div style="padding: 16px; background: #012E37;">
                            <button class="copy-button" onclick="copyCodeFromPre(this)" style="margin-bottom: 8px;">Copy JSON</button>
                            <pre style="margin: 0; overflow-x: auto; color: #D8FEF3; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.5;">${escapeHtml(JSON.stringify(results.balance, null, 2))}</pre>
                        </div>
                    </details>
                `;
            }
            
            if (results.transactions) {
                html += `
                    <details style="margin: 16px 0; border: 2px solid #D8FEF3; border-radius: 8px; overflow: hidden;">
                        <summary style="padding: 12px; background: #D8FEF3; cursor: pointer; font-weight: 600; color: #05565C;">
                            üìÑ POST /transactions/sync - Full Response
                        </summary>
                        <div style="padding: 16px; background: #012E37;">
                            <button class="copy-button" onclick="copyCodeFromPre(this)" style="margin-bottom: 8px;">Copy JSON</button>
                            <pre style="margin: 0; overflow-x: auto; color: #D8FEF3; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.5;">${escapeHtml(JSON.stringify(results.transactions, null, 2))}</pre>
                        </div>
                    </details>
                `;
            }
            
            html += `</div>`;
            
            resultsContent.innerHTML = html;
            resultsDiv.style.display = 'block';
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            showToast('‚úÖ Demo complete! Data displayed below.', 'success');
        }
        
        // Generate scope calculator
        function generateScope(solution) {
            const content = document.getElementById('scopeContent');
            
            const complexity = solution.complexity;
            const weeks = solution.timeline.weeks;
            const productCount = solution.products.length;
            
            // Calculate estimates
            const devHours = {
                'low': 40,
                'medium': 120,
                'high': 240
            }[complexity];
            
            const teamSize = complexity === 'low' ? '1 developer' : 
                           complexity === 'medium' ? '1-2 developers' : 
                           '2-3 developers';
            
            const complexityBadgeText = complexity === 'low' ? '‚úÖ Straightforward' : 
                                       complexity === 'medium' ? '‚ö†Ô∏è Moderate' : 
                                       'üî• Advanced';
            
            const teamSizeNumber = teamSize.split(' ')[0];
            
            const phases = generateTimelinePhases(complexity, weeks);
            
            content.innerHTML = `
                <div class="info-box">
                    <h3>‚è±Ô∏è Integration Scope Analysis</h3>
                    <p>Based on your use case requiring ` + productCount + ` Plaid products, here's a realistic timeline and resource estimate.</p>
                </div>
                
                <div class="scope-grid">
                    <div class="scope-card">
                        <div class="scope-icon">üìÖ</div>
                        <div class="scope-label">Estimated Timeline</div>
                        <div class="scope-value">` + weeks + ` weeks</div>
                        <div class="scope-detail">From kickoff to production-ready</div>
                    </div>
                    
                    <div class="scope-card">
                        <div class="scope-icon">‚öôÔ∏è</div>
                        <div class="scope-label">Complexity Level</div>
                        <div class="scope-value">` + complexity.toUpperCase() + `</div>
                        <div class="complexity-badge complexity-` + complexity + `">
                            ` + complexityBadgeText + `
                        </div>
                    </div>
                    
                    <div class="scope-card">
                        <div class="scope-icon">üíª</div>
                        <div class="scope-label">Development Hours</div>
                        <div class="scope-value">` + devHours + `h</div>
                        <div class="scope-detail">Engineering time estimate</div>
                    </div>
                    
                    <div class="scope-card">
                        <div class="scope-icon">üë•</div>
                        <div class="scope-label">Team Size</div>
                        <div class="scope-value">` + teamSizeNumber + `</div>
                        <div class="scope-detail">` + teamSize + `</div>
                    </div>
                </div>
                
                <h3 class="section-header">Development Timeline</h3>
                ` + phases + `
                
                <div class="info-box" style="background: linear-gradient(135deg, #E6E6FF 0%, #F9DBFF 100%); border-left-color: #8B8BF9;">
                    <h3>üéØ Success Factors</h3>
                    <ul>
                        <li><strong>Use Sandbox First:</strong> Test with free sandbox data before going live</li>
                        <li><strong>Implement Webhooks Early:</strong> Critical for production reliability</li>
                        <li><strong>Plan for Edge Cases:</strong> Connection failures, MFA, re-authentication</li>
                        <li><strong>Security Review:</strong> Ensure proper access_token storage and encryption</li>
                        <li><strong>Compliance Check:</strong> Review data retention and privacy requirements</li>
                    </ul>
                </div>
                
                <h3 class="section-header">Resource Requirements</h3>
                <div class="info-box">
                    <h3>Technical Stack Needed</h3>
                    <ul>
                        <li><strong>Backend:</strong> Node.js/Python server with database (PostgreSQL recommended)</li>
                        <li><strong>Frontend:</strong> React/Vue/Angular for Link integration</li>
                        <li><strong>Infrastructure:</strong> HTTPS endpoints for webhooks, secure token storage</li>
                        <li><strong>Testing:</strong> Sandbox environment, test bank credentials</li>
                    </ul>
                </div>
            `;
        }
        
        // Generate timeline phases
        function generateTimelinePhases(complexity, totalWeeks) {
            const phases = [];
            
            if (complexity === 'low') {
                phases.push({
                    name: 'Week 1: Setup & Basic Integration',
                    duration: '1 week',
                    tasks: 'Set up Plaid account, implement Link flow, exchange tokens, test in sandbox'
                });
                phases.push({
                    name: 'Week 2: Data Integration',
                    duration: '1 week',
                    tasks: 'Fetch and store data, implement webhooks, handle errors'
                });
                phases.push({
                    name: 'Week 3: Testing & Launch',
                    duration: '1 week',
                    tasks: 'End-to-end testing, security review, production deployment'
                });
            } else if (complexity === 'medium') {
                phases.push({
                    name: 'Weeks 1-2: Foundation',
                    duration: '2 weeks',
                    tasks: 'Architecture design, Plaid setup, Link integration, token management'
                });
                phases.push({
                    name: 'Weeks 3-4: Core Features',
                    duration: '2 weeks',
                    tasks: 'Product integrations, webhook handlers, data processing, UI development'
                });
                phases.push({
                    name: 'Weeks 5-6: Testing & Launch',
                    duration: '2 weeks',
                    tasks: 'Integration testing, error handling, security audit, production deployment'
                });
            } else {
                phases.push({
                    name: 'Weeks 1-2: Planning & Architecture',
                    duration: '2 weeks',
                    tasks: 'Technical design, database schema, security architecture, API integration plan'
                });
                phases.push({
                    name: 'Weeks 3-5: Core Development',
                    duration: '3 weeks',
                    tasks: 'All product integrations, webhook infrastructure, data pipelines, UI components'
                });
                phases.push({
                    name: 'Weeks 6-8: Advanced Features',
                    duration: '3 weeks',
                    tasks: 'Edge case handling, Update Mode, error recovery, monitoring'
                });
                phases.push({
                    name: 'Weeks 9-10: Testing & Launch',
                    duration: '2 weeks',
                    tasks: 'Full integration testing, security review, compliance check, production deployment'
                });
            }
            
            return phases.map(phase => `
                <div class="timeline-phase">
                    <div class="phase-header">
                        <div class="phase-name">${phase.name}</div>
                        <div class="phase-duration">${phase.duration}</div>
                    </div>
                    <div class="phase-tasks">${phase.tasks}</div>
                </div>
            `).join('');
        }
        
        // Generate export section
        function generateExport(solution) {
            const content = document.getElementById('exportContent');
            
            content.innerHTML = `
                <div class="info-box">
                    <h3>üì§ Export Your Solution Guide</h3>
                    <p>Share this comprehensive solution guide with your customer or save it for your records.</p>
                </div>
                
                <div class="export-actions">
                    <button class="export-button btn-primary" onclick="exportToPDF()">
                        üìÑ Download as PDF
                    </button>
                    <button class="export-button btn-secondary" onclick="exportToHTML()">
                        üíæ Export HTML Guide
                    </button>
                    <button class="export-button btn-secondary" onclick="copyShareLink()">
                        üîó Copy Shareable Link
                    </button>
                </div>
                
                <h3 class="section-header">What's Included</h3>
                <div class="info-box" style="background: white; border: 2px solid #D8FEF3;">
                    <ul>
                        <li>‚úÖ Product recommendations with detailed descriptions</li>
                        <li>‚úÖ Complete architecture diagram (Mermaid format)</li>
                        <li>‚úÖ Production-ready code examples (Node.js & Python)</li>
                        <li>‚úÖ Integration scope calculator with timeline</li>
                        <li>‚úÖ Direct links to Plaid documentation</li>
                        <li>‚úÖ Implementation best practices</li>
                    </ul>
                </div>
                
                <h3 class="section-header">Next Steps</h3>
                <div class="info-box" style="background: linear-gradient(135deg, #E8FED7 0%, #D8FEF3 100%); border-left-color: #46DA10;">
                    <h3>üöÄ Ready to Build?</h3>
                    <ol style="margin: 12px 0 0 20px; color: #012E37; line-height: 1.8;">
                        <li>Sign up for a <a href="https://dashboard.plaid.com/signup" target="_blank" style="color: #0B7BBC; font-weight: 600;">free Plaid account</a></li>
                        <li>Get your sandbox API keys from the <a href="https://dashboard.plaid.com/developers/keys" target="_blank" style="color: #0B7BBC; font-weight: 600;">Dashboard</a></li>
                        <li>Copy the code examples from the Code tab</li>
                        <li>Test with sandbox credentials (see <a href="https://plaid.com/docs/sandbox/test-credentials/" target="_blank" style="color: #0B7BBC; font-weight: 600;">test credentials</a>)</li>
                        <li>Join <a href="https://plaid.com/slack" target="_blank" style="color: #0B7BBC; font-weight: 600;">Plaid Slack</a> for developer support</li>
                    </ol>
                </div>
                
                <div class="doc-links" style="margin-top: 24px;">
                    <a href="https://plaid.com/docs/" target="_blank" class="doc-link">üìñ Complete Documentation</a>
                    <a href="https://plaid.com/docs/quickstart/" target="_blank" class="doc-link">‚ö° Quickstart Guide</a>
                    <a href="https://github.com/plaid/quickstart" target="_blank" class="doc-link">üíª GitHub Quickstart</a>
                    <a href="https://dashboard.plaid.com/" target="_blank" class="doc-link">üéõÔ∏è Plaid Dashboard</a>
                </div>
            `;
        }
        
        // Export functions
        function exportToPDF() {
            window.print();
        }
        
        function exportToHTML() {
            // Get the entire solution as HTML
            const fullHTML = document.documentElement.outerHTML;
            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'plaid-solution-guide.html';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function copyShareLink() {
            // In a real implementation, this would generate a unique share link
            const link = window.location.href;
            navigator.clipboard.writeText(link).then(() => {
                alert('‚úÖ Link copied to clipboard!\n\nNote: In production, this would generate a unique shareable link.');
            });
        }
        
        // Utility functions
        function copyToClipboard(button, code) {
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = '‚úÖ Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }
        
        function copyCodeFromPre(button) {
            const pre = button.nextElementSibling;
            const code = pre.textContent;
            copyToClipboard(button, code);
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>

